{% extends 'user-base.html' %}
{% load static %}
{% block title %}
Jobs
{% endblock %}
{% block javascript %}
<script src="{% static 'js/jobs.js' %}"></script>
<script src="{% static 'js/jquery.formset.js' %}"></script>
<script>
   $('.label-formset').formset({
     addText: 'Add label',
     deleteText: 'remove',
     prefix: 'fs1',
     formCssClass: 'dynamic-formset1'
   });
   $('.envvar-formset').formset({
     addText: 'Add environment variable',
     deleteText: 'remove',
     prefix: 'fs2',
     formCssClass: 'dynamic-formset2'
   });
   $('.artifact-formset').formset({
     addText: 'Add artifact',
     deleteText: 'remove',
     prefix: 'fs3',
     formCssClass: 'dynamic-formset3'
   });
</script>
{% endblock %}
{% block contentuser %}
<h2><a href="https://prominence.cloud/jobs"><i class="feather-32" data-feather="arrow-left"></i></a> Create job</h2>
<br/>
<form method="post" action="{% url 'job_create' %}">
   {% csrf_token %}
   <div class="project-tab">
      <div class="container">
         <div class="row">
            <div class="col-md-12">
               <div class="nav nav-tabs">
                  <a class="nav-item nav-link active" data-toggle="tab" href="#metadata">Metadata</a>
                  <a class="nav-item nav-link" data-toggle="tab" href="#task">Task</a>
                  <a class="nav-item nav-link" data-toggle="tab" href="#resources">Resources</a>
                  <a class="nav-item nav-link" data-toggle="tab" href="#inputs">Input files</a>
                  <a class="nav-item nav-link" data-toggle="tab" href="#artifacts">Artifacts</a>
                  <a class="nav-item nav-link" data-toggle="tab" href="#storage">Storage</a>
                  <a class="nav-item nav-link" data-toggle="tab" href="#policies">Policies</a>
               </div>
               <div class="tab-content">
                  <div id="metadata" class="tab-pane fade show active">
                     <br/>
                     Assign a name and any arbitrary labels as key-value pairs.
                     <br/>
                     <br/>
                     <b>Name</b><font class="text-secondary"> (Optional)</font><br/>
                     {{ form.name }}
                     <br/>
                     <br/>
                     <b>Labels</b><font class="text-secondary"> (Optional)</font><br/>
                     {{ labels_formset.management_form }}
                     {% for label_form in labels_formset %}
                     <div class="label-formset">
                        {{ label_form.key }}
                        {{ label_form.value }}
                     </div>
                     {% endfor %}
                  </div>
                  <div id="task" class="tab-pane fade">
                     <br/>
                     <b>Task type</b><br/>
                     {{ form.task_type }}
                     <br/><br/>
                     <b>Container image</b><br/>
                     {{ form.container_image }}
                     <br/><br/>
                     <b>Container runtime</b><br/>
                     {{ form.container_runtime }}
                     <br/><br/>
                     <b>Command</b><font class="text-secondary"> (Optional)</font><br/>
                     {{ form.command }}
                     <br/><br/>
                     <b>Work directory</b><font class="text-secondary"> (Optional)</font><br/>
                     {{ form.workdir }}
                     <br/><br/>
                     <b>Environment variables</b><font class="text-secondary"> (Optional)</font><br/>
                     {{ envvars_formset.management_form }}
                     {% for envvar_form in envvars_formset %}
                     <div class="envvar-formset">
                        {{ envvar_form.key }}
                        {{ envvar_form.value }}
                     </div>
                     {% endfor %}
                  </div>
                  <div id="resources" class="tab-pane fade">
                     <br/>
                     Specify the resources required, including the number of nodes required for the job and the number of CPUs and amount of memory and disk space per node. An upper limit to the walltime required by the job is also specified.
                     <br/>
                     <br/>
                     <table>
                        <tr>
                           <td>{{ form.nodes.label }}</td>
                           <td>{{ form.nodes }}</td>
                        </tr>
                        <tr>
                           <td>{{ form.cpus.label }}</td>
                           <td>{{ form.cpus }}</td>
                        </tr>
                        <tr>
                           <td>{{ form.memory.label }}</td>
                           <td>{{ form.memory }}</td>
                        </tr>
                        <tr>
                           <td>{{ form.disk.label }}</td>
                           <td>{{ form.disk }}</td>
                        </tr>
                        <tr>
                           <td>{{ form.walltime.label }}</td>
                           <td>{{ form.walltime }}</td>
                        </tr>
                     </table>
                  </div>
                  <div id="inputs" class="tab-pane fade">
                     <br/>
                     Any small input files required by the job.
                     <br/>
                     <br/>
                  </div>
                  <div id="artifacts" class="tab-pane fade">
                     <br/>
                     Additional input files which can be obtained from a URL.
                     <br/>
                     <br/>
                     {{ artifacts_formset.management_form }}
                     {% for artifact_form in artifacts_formset %}
                     <div class="artifact-formset">
                        {{ artifact_form.url.label_tag }}
                        {{ artifact_form.url }}
                        {{ artifact_form.executable.label_tag }}
                        {{ artifact_form.executable }}
                     </div>
                     {% endfor %}
                  </div>
                  <div id="storage" class="tab-pane fade">
                     <br/>
                     Storage to be provided to jobs in a POSIX-like way.
                     <br/>
                     <br/>
                     <b>Name</b><br/>
                     {{ form.storage_name }}
                     <br/>
                     <br/>
                     <b>Mount point</b><br/>
                     {{ form.storage_mountpoint }}
                  </div>
                  <div id="policies" class="tab-pane fade">
                     <br/>
                     Policies can influence the way failures are handled and how resources are placed.
                     <br/>
                     <br/>
                     <b>Number of retries per task</b><br/>
                     {{ form.policy_task_maxretries }}
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <br/>
   <br/>
   <button type="submit" class="btn btn-primary">Create</button>
</form>
<br/>
{% endblock %}
