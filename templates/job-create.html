{% extends 'user-base.html' %}

{% load static %}

{% block title %}
  Jobs
{% endblock %}

{% block javascript %}
  <script src="{% static 'js/jobs.js' %}"></script>
  <script src="{% static 'js/jquery.formset.js' %}"></script>
  <script>
    $('.envvar-formset').formset({
      addText: 'Add environment variable',
      deleteText: 'remove',
      prefix: '{{ envvars_formset.prefix }}',
      formCssClass: 'dynamic-formset1'
    });
    $('.label-formset').formset({
      addText: 'Add label',
      deleteText: 'remove',
      prefix: '{{ labels_formset.prefix }}',
      formCssClass: 'dynamic-formset2'
    });
    $('.artifact-formset').formset({
      addText: 'Add artifact',
      deleteText: 'remove',
      prefix: '{{ artifacts_formset.prefix }}',
      formCssClass: 'dynamic-formset3'
    });
  </script>
{% endblock %}

{% block contentuser %}
  <h2>Create job</h2>

  <div class="col-md-6">
<form method="post" action="{% url 'job_create' %}" class="js-job-add-form">
  {% csrf_token %}

  <b>Name</b><br/>
  {{ form.name }}

  <br/>
  <br/>
  <b>Task</b>
  <table>
	  <tr>
		  <td>Type</td>
		  <td>{{ form.task_type }}</td>
		  </tr>
	  <tr>
  <td>Container image</td>
  <td>{{ form.container_image }}</td>
	  </tr>
	  <tr>

		  <td>Container runtime</td>
		  <td>{{ form.container_runtime }}</td>

	  </tr>
	  <tr>
  <td>Command</td>
  <td>{{ form.command }}</td>
	  </tr>
  </table>
  Environment variables <br/>
{{ envvars_formset.management_form }}

  {% for envvar_form in envvars_formset %}
  <div class="envvar-formset">
	  {{ envvar_form.key }}
	  {{ envvar_form.value }}
  </div>
  {% endfor %}

  <br/>
  <br/>
  <b>Resources</b>
  <div class="card">
	  <div class="card-body">
  <table>
	  <tr>
		  <td>Nodes</td>
		  <td>{{ form.nodes }}
		  </td>
	  </tr>
	  <tr>
		  <td>CPUs</td>
		  <td>{{ form.cpus }}</td>
	  </tr>
	  <tr>
		  <td>Memory</td>
		  <td>{{ form.memory }}</td>
		  </tr>
	  <tr>
		  <td>Disk</td>
		  <td>{{ form.disk }}</td>
	  </tr>
  </table>
	  </div>
  </div>


  {{ labels_formset.management_form }}

  <br/>
  <b>Labels</b><br/>
  {% for label_form in labels_formset %}
  <div class="label-formset">
	  {{ label_form.key }}
	  {{ label_form.value }}
  </div>
  {% endfor %}

  {{ artifacts_formset.management_form }}

  <br/>
  <br/>
  <b>Artifacts</b><br/>
  {% for artifact_form in artifacts_formset %}
  <div class="artifact-formset">
	  {{ artifact_form.url.label_tag }}
	  {{ artifact_form.url }}
	  {{ artifact_form.executable.label_tag }}
	  {{ artifact_form.executable }}
  </div>
  {% endfor %}

  <br/>
  <br/>
  <b>Storage</b>
  <table>
	  <tr>
		  <td>Name</td>
		  <td>{{ form.storage_name }}</td>
	  </tr>
	  <tr>
		  <td>Mount point</td>
		  <td>{{ form.storage_mountpoint }}</td>
	  </tr>
  </table>

  <br/>


    <button type="submit" class="btn btn-primary">Create</button>
</form>
  </div>

  <div class="modal fade" id="modal-jobs">
    <div class="modal-dialog">
      <div class="modal-content">
      </div>
    </div>
  </div>

{% endblock %}
