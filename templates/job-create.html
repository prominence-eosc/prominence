{% extends 'user-base.html' %}

{% load static %}

{% block title %}
  Jobs
{% endblock %}

{% block javascript %}
  <script src="{% static 'js/jobs.js' %}"></script>
  <script src="{% static 'js/jquery.formset.js' %}"></script>
  <script>
    $('.envvar-formset').formset({
      addText: 'Add environment variable',
      deleteText: 'remove',
      prefix: '{{ envvars_formset.prefix }}',
      formCssClass: 'dynamic-formset1'
    });
    $('.label-formset').formset({
      addText: 'Add label',
      deleteText: 'remove',
      prefix: '{{ labels_formset.prefix }}',
      formCssClass: 'dynamic-formset2'
    });
    $('.artifact-formset').formset({
      addText: 'Add artifact',
      deleteText: 'remove',
      prefix: '{{ artifacts_formset.prefix }}',
      formCssClass: 'dynamic-formset3'
    });
  </script>
{% endblock %}

{% block contentuser %}
<h2><a href="https://prominence.cloud/jobs"><i class="feather-32" data-feather="arrow-left"></i></a> Create job</h2>
  <br/>

<form method="post" action="{% url 'job_create' %}" class="js-job-add-form">
  {% csrf_token %}
  <div class="project-tab">
	  <div class="container">
	  <div class="row">
		  <div class="col-md-12">
<div class="nav nav-tabs">
  <a class="nav-item"><a class="nav-link active" data-toggle="tab" href="#metadata">Metadata</a></li>
  <a class="nav-item"><a class="nav-link" data-toggle="tab" href="#task">Task</a></li>
  <a class="nav-item"><a class="nav-link" data-toggle="tab" href="#resources">Resources</a></li>
  <a class="nav-item"><a class="nav-link" data-toggle="tab" href="#inputs">Input files</a></li>
  <a class="nav-item"><a class="nav-link" data-toggle="tab" href="#artifacts">Artifacts</a></li>
  <a class="nav-item"><a class="nav-link" data-toggle="tab" href="#storage">Storage</a></li>
  <a class="nav-item"><a class="nav-link" data-toggle="tab" href="#policies">Policies</a></li>
</div>
  
<div class="tab-content">
  <div id="metadata" class="tab-pane fade show active">
  <br/>
  Assign a name and any arbitrary labels as key-value pairs.

  <br/>
  <br/>
  <b>Name</b> (Optional)<br/>
  {{ form.name }}


  {{ labels_formset.management_form }}

  <br/>
  <br/>
  <b>Labels</b> (Optional)<br/>
  {% for label_form in labels_formset %}
  <div class="label-formset">
	  {{ label_form.key }}
	  {{ label_form.value }}
  </div>
  {% endfor %}

  </div>
  <div id="task" class="tab-pane fade">
	  <br/>
  <table>
	  <tr>
		  <td>Type</td>
		  <td>{{ form.task_type }}</td>
		  </tr>
	  <tr>
  <td>Container image</td>
  <td>{{ form.container_image }}</td>
	  </tr>
	  <tr>

		  <td>Container runtime</td>
		  <td>{{ form.container_runtime }}</td>

	  </tr>
	  <tr>
  <td>Command</td>
  <td>{{ form.command }}</td>
	  </tr>
	  <tr>
	  <td>Work directory</td>
	  <td>{{ form.workdir }}</td>
	  </tr>
  </table>
  Environment variables <br/>
{{ envvars_formset.management_form }}

  {% for envvar_form in envvars_formset %}
  <div class="envvar-formset">
	  {{ envvar_form.key }}
	  {{ envvar_form.value }}
  </div>
  {% endfor %}

  </div>
  <div id="resources" class="tab-pane fade">

	  <br/>

Specify the resources required, including the number of nodes required for the job and the number of CPUs and amount of memory and disk space per node. An upper limit to the walltime required by the job is also specified.
<br/>
<br/>

  <table>
	  <tr>
		  <td>{{ form.nodes.label }}</td>
		  <td>{{ form.nodes }}</td>
	  </tr>
	  <tr>
		  <td>{{ form.cpus.label }}</td>
		  <td>{{ form.cpus }}</td>
	  </tr>
	  <tr>
		  <td>{{ form.memory.label }}</td>
		  <td>{{ form.memory }}</td>
		  </tr>
	  <tr>
		  <td>{{ form.disk.label }}</td>
		  <td>{{ form.disk }}</td>
	  </tr>
	  <tr>
		  <td>{{ form.walltime.label }}</td>
		  <td>{{ form.walltime }}</td>
	  </tr>
  </table>

  </div>

  <div id="inputs" class="tab-pane fade">

<br/>
Any small input files required by the job.
<br/>
<br/>


  </div>

  <div id="artifacts" class="tab-pane fade">
<br/>
Additional input files which can be obtained from a URL.
<br/>
<br/>

  {{ artifacts_formset.management_form }}

  <br/>
  {% for artifact_form in artifacts_formset %}
  <div class="artifact-formset">
          {{ artifact_form.url.label_tag }}
          {{ artifact_form.url }}
          {{ artifact_form.executable.label_tag }}
          {{ artifact_form.executable }}
  </div>
  {% endfor %}

  </div>

  <div id="storage" class="tab-pane fade">

<br/>
Storage to be provided to jobs in a POSIX-like way.
<br/>
<br/>


                  <b>Name</b><br/>
                  {{ form.storage_name }}
<br/>
<br/>
                  <b>Mount point</b><br/>
                  {{ form.storage_mountpoint }}

  </div>

  <div id="policies" class="tab-pane fade">
	  <br/>
Policies can influence the way failures are handled and how resources are placed.
	  <br/>
	  <br/>

 <b>Number of retries per task</b><br/>
		  {{ form.policy_task_maxretries }}

  </div>
</div>
</div>
</div>
	  </div>

  <br/>
  <br/>


    <button type="submit" class="btn btn-primary">Create</button>
</form>

  <br/>

  <div class="modal fade" id="modal-jobs">
    <div class="modal-dialog">
      <div class="modal-content">
      </div>
    </div>
  </div>

{% endblock %}
