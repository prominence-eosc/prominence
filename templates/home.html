{% extends 'user-base.html' %}

{% load static %}

{% block javascript %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.js" integrity="sha512-G8JE1Xbr0egZE5gNGyUm1fF764iHVfRXshIoUWCTPAbKkkItp/6qal5YAHXrxEu4HNfPTQs6HOu3D5vCGS1j3w==" crossorigin="anonymous"></script>
<script>
function renderChart(data_running, data_idle, label) {
    var ctx = document.getElementById('recent-jobs-chart').getContext('2d');
    var chart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [{
                label: 'Running',
                borderColor: 'rgb(0, 0, 0)',
		fill: false,
		pointRadius: 0,
		data: data_running
            },
            {
                label: 'Idle',
                borderColor: 'rgb(0, 0, 255)',
		fill: false,
		pointRadius: 0,
		data: data_idle
            }],
        },
        options: {
            legend: {
	        display: true
	    },
            scales: {
                xAxes: [{
                    type: 'time',
                    distribution: 'linear',
		    time: {
			    min: '{{ xaxis_min }}',
			    max: '{{ xaxis_max }}',
                    displayFormats: {
                        hour: 'HH',
                        minute: 'HH:mm',
                        second: 'HH:mm:ss'}
		    }
	        }]
	    }
        }
    });
}

function getChartData() {
    $("#loadingMessage").html('<span data-feather="loader"></span>');
    $.ajax({
        url: "/user/usage/",
        success: function (result) {
            $("#loadingMessage").html("");
            renderChart(result.running, result.idle, 'Recent jobs');
        },
        error: function (err) {
            $("#loadingMessage").html("Error");
        }
    });
}

$(document).ready(function () {
    getChartData();
});
</script>
{% endblock %}

{% block contentuser %}
<div class="card">
<div class="card-body">
<h6 class="card-title">Recent job history</h6>
<div class="container">
<div class="row">
<div class="col-sm-8">
<canvas id="recent-jobs-chart" width="800" height="400"></canvas>
</div>
</div>
</div>
</div>
</div>
{% endblock %}
